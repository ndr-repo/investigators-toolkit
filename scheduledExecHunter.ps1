Write-Host "`nLocating Scheduled Tasks with file execution instructions...`n" -ForegroundColor Red ; Get-ScheduledTask | Where-Object -Property State -EQ Running | Select-Object -ExpandProperty TaskName | % { Get-ScheduledTask -TaskName $_ | Select-Object -ExpandProperty CimInstanceProperties | Where-Object -Property Name -EQ Actions | Select-Object -ExpandProperty Value | Select-Object -ExpandProperty Execute -ErrorAction SilentlyContinue } ; Write-Host ' ' ; Get-ScheduledTask | Where-Object -Property State -EQ Running | Select-Object -ExpandProperty TaskName | % { Get-ScheduledTask -TaskName $_ | Select-Object -ExpandProperty CimInstanceProperties | Where-Object -Property Name -EQ Actions | Select-Object -ExpandProperty Value | Select-Object -ExpandProperty Execute -ErrorAction SilentlyContinue | Out-String -Stream | % { Get-FileHash $_ | Select-Object -ExpandProperty Hash } } ; Get-ScheduledTask | Where-Object -Property State -EQ Running | Select-Object -ExpandProperty TaskName | % { Get-ScheduledTask -TaskName $_ | Select-Object -ExpandProperty CimInstanceProperties | Where-Object -Property Name -EQ Actions | Select-Object -ExpandProperty Value | Select-Object -ExpandProperty Execute -ErrorAction SilentlyContinue | Out-String -Stream | % { Get-FileHash $_ | Select-Object -ExpandProperty Hash | % { Invoke-RestMethod -ErrorAction SilentlyContinue -Method Get -UserAgent "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:143.0) Gecko/20100101 Firefox/143.0" -Uri "https://otx.alienvault.com/api/v1/indicators/file/$_/general" | Select-Object -ExpandProperty pulse_info -ErrorAction SilentlyContinue } } }
